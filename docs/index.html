<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Want to add an option for your blog readers to recieve your blog posts in their email without moving to service like SubStack? blog2newsletter has you covered.
">
<title>An R package to send blog posts as emails / newsletters. • blog2newsletter</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="An R package to send blog posts as emails / newsletters.">
<meta property="og:description" content="Want to add an option for your blog readers to recieve your blog posts in their email without moving to service like SubStack? blog2newsletter has you covered.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">blog2newsletter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="blog2newsletter">blog2newsletter<a class="anchor" aria-label="anchor" href="#blog2newsletter"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>The goal of blog2newsletter is to provide a <strong>relatively</strong> simple way to send your R based blog posts as emails to subscribers.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of blog2newsletter from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"rmflight/blog2newsletter"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_2-second-overview">2 Second Overview<a class="anchor" aria-label="anchor" href="#id_2-second-overview"></a>
</h2>
<ul>
<li>The blog in question has an RSS feed where each entry is essentially the full post.</li>
<li>Have subscribers and categories they want to know about in a Google Sheet, a copy of which is stored locally as well.</li>
<li>
<a href="https://github.com/RobertMyles/tidyrss" class="external-link">tidyRSS</a> parses the RSS to get an emailable version of the post, we find subscribers to email based on matching categories, and draft an email.</li>
<li>
<a href="https://gmailr.r-lib.org" class="external-link">gmailr</a> either shows us the draft, or sends the newsletter email, and records that we sent it in the cache so we don’t accidentally send multiples of the same post.</li>
</ul>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>The current version is based on a particular workflow:</p>
<ul>
<li>GMail to send the messages;</li>
<li>Google Forms and Google Sheets to store the subscriber information;</li>
<li>Blog RSS feed to generate the content that goes in each newsletter.</li>
</ul>
<p>This means you need a Google account, and a project, with the Gmail and Google Sheets API authorized. We may eventually change what pieces are needed, but right now, this is what it expects.</p>
<p>The <code>gmailr</code> <a href="https://gmailr.r-lib.org/articles/gmailr.html" class="external-link">quick start</a> has a good example of how to set up a project with the right permissions.</p>
<div class="section level3">
<h3 id="gmail-oauth-scopes">Gmail Oauth Scopes<a class="anchor" aria-label="anchor" href="#gmail-oauth-scopes"></a>
</h3>
<p>One very important thing to note, is when you do the initial oauth setup, whatever <code>scopes</code> you use then, when you set it up again in the <code>{blog2newsletter}</code> workflow, make sure the <code>scopes</code> is identical, or you will have to do the whole browser oauth flow <strong>again</strong> (ask me how many times it took before I realized I had a different scope causing this).</p>
<p>For this project, really all you need are the <code>compose</code> and <code>send</code> scopes, so that you can see the draft in Gmail if you want, and send on your behalf, as shown here:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gm_auth</span><span class="op">(</span>scopes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compose"</span>, <span class="st">"send"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="google-sheets-oauth-scopes">Google Sheets Oauth Scopes<a class="anchor" aria-label="anchor" href="#google-sheets-oauth-scopes"></a>
</h3>
<p>Similarly, Google Sheets only needs to be able to read the response sheet you are using to record the form responses.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gs4_auth</span><span class="op">(</span>scopes <span class="op">=</span> <span class="st">"https://www.googleapis.com/auth/spreadsheets.readonly"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-note-on-storing-the-secrets-json-and-oauth">A Note on Storing the Secrets JSON and Oauth<a class="anchor" aria-label="anchor" href="#a-note-on-storing-the-secrets-json-and-oauth"></a>
</h3>
<p>I definitely recommend having a specific Google project for this so that API secrets don’t need to be shared across projects. In addition, the directory / R project should be on it’s own, not part of your blog directory if you use a static site generator, and committing nothing, except maybe the <code>_blog2newsletter.R</code> script if you really want to. This helps to avoid accidentally committing the secrets and tokens you are generating. Whether part of a blog directory project or not, you can help avoid accidentally commiting them to git using <a href="https://usethis.r-lib.org" class="external-link">usethis</a> to add the <code>secrets</code> directory to the <code>.gitignore</code> file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_git_ignore.html" class="external-link">use_git_ignore</a></span><span class="op">(</span><span class="st">"secrets"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="subscription-categories">Subscription Categories<a class="anchor" aria-label="anchor" href="#subscription-categories"></a>
</h2>
<p>Another aspect that is used heavily are blog post categories. In many cases, blogs use categories so readers can find things that are more interesting to them. For example, I would guess that more people probably read my posts that focus on <code>R</code> (I actually am guessing because I don’t actually track my traffic) than some other categories. Therefore, you can give your potential subscribers categories to choose from.</p>
<p>Here are the categories I put on my own subscription form:</p>
<p><img src="reference/figures/rmflight_categories.png" width="100%"></p>
<p>These categories are based on looking at my blog sidebar, and looking at the categories with the most posts.</p>
<p><strong>If you don’t have categories, you can give the option for ALL, and subscribers will get every post</strong>.</p>
</div>
<div class="section level2">
<h2 id="getting-setup">Getting Setup<a class="anchor" aria-label="anchor" href="#getting-setup"></a>
</h2>
<div class="section level3">
<h3 id="create-a-google-form-to-store-subscribers">Create a Google Form to Store Subscribers<a class="anchor" aria-label="anchor" href="#create-a-google-form-to-store-subscribers"></a>
</h3>
<p>Assuming you have a Google account (which lets face it, is basically assumed for this entire workflow), create a form at <a href="https://docs.google.com/forms" class="external-link uri">https://docs.google.com/forms</a>.</p>
<p>This form should <strong>collect emails</strong> (seriously, you can’t get an email newsletter without an email address):</p>
<p>Settings -&gt; Responses -&gt; Collect email addresses -&gt; On</p>
<p><img src="reference/figures/collect_emails.png" width="100%"></p>
<p>If using <strong>categories</strong>, add your categories as <strong>checkboxes</strong> so subscribers can choose multiple subjects of posts. If <strong>not using</strong> categories, I would at least add the option for “All”. Mainly because this first version of <code>{blog2newsletter}</code> checks for that one, and the absence of any other categories means that no one will get your newsletter.</p>
<p>Make sure to put the link to the form somewhere prominent on your blog!</p>
</div>
<div class="section level3">
<h3 id="setup-an-r--rstudio-project">Setup an R / RStudio Project<a class="anchor" aria-label="anchor" href="#setup-an-r--rstudio-project"></a>
</h3>
<p>We are going to pretend we’ve made a project called <code>blog_subscriptions</code>.</p>
<p>Here is the overall file structure that we’ll end up with for this project. Keep in mind that the file names for the secrets and oauth will be different, this just shows where they are in my setup.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>├── _blog2newsletter</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>│   ├── emails</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>│   └── subscribers</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>├── _blog2newsletter.R</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>├── secrets</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>│   ├── google<span class="sc">-</span>project<span class="sc">-</span>secrets.json</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>│   └── gargle_cache</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>│       ├── gmailr_oauth</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>│       └── goooglesheets4_oauth</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="google-secrets-and-oauth">Google Secrets and Oauth<a class="anchor" aria-label="anchor" href="#google-secrets-and-oauth"></a>
</h3>
<p>Download the secrets JSON file from your Google project, and store it in <code>secrets</code> (or your chosen location).</p>
<p>Do the oauth setup for <a href="https://gmailr.r-lib.org" class="external-link">gmailr</a> and <a href="https://googlesheets4.tidyverse.org" class="external-link">googlesheets4</a>. You can do that using the code below, and it should give you a browser window to verify yourself. Once the oauth tokens are stored, you won’t have to do the browser again until the token expires, as long as you don’t change the <code>scopes</code> parameter.</p>
<p>This code, by the way, <strong>should always</strong> be at the top of either <code>_blog2newsletter.R</code>, or any other script you use to generate the newsletter.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  gargle_oauth_cache <span class="op">=</span> <span class="st">"secrets/gargle_cache/"</span>,</span>
<span>  gargle_oauth_email <span class="op">=</span> <span class="st">"your_email@gmail.com"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gmailr.r-lib.org" class="external-link">gmailr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://gmailr.r-lib.org/reference/gm_auth_configure.html" class="external-link">gm_auth_configure</a></span><span class="op">(</span>path  <span class="op">=</span> <span class="st">"secrets/secrets_file.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://gmailr.r-lib.org/reference/gm_auth.html" class="external-link">gm_auth</a></span><span class="op">(</span>scopes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compose"</span>, <span class="st">"send"</span><span class="op">)</span>, email <span class="op">=</span> <span class="st">"your_email@gmail.com"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org" class="external-link">googlesheets4</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth_configure.html" class="external-link">gs4_auth_configure</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"secrets/secrets_file.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth.html" class="external-link">gs4_auth</a></span><span class="op">(</span></span>
<span>  scopes <span class="op">=</span> <span class="st">"https://www.googleapis.com/auth/spreadsheets.readonly"</span>,</span>
<span>  email <span class="op">=</span> <span class="st">"your_email@gmail.com"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setup-the-blog2newsletter-cache-folder">Setup the blog2newsletter Cache Folder<a class="anchor" aria-label="anchor" href="#setup-the-blog2newsletter-cache-folder"></a>
</h3>
<p>There are two files that <code>{blog2newsletter}</code> uses to keep track of things, <code>subscribers</code> and <code>emails</code>.</p>
<ul>
<li>
<code>subscribers</code>: stores a local copy of the form submissions from the Google Sheet so you aren’t always fetching a new copy. Defaults to refetching after 168 hours (a week).</li>
<li>
<code>emails</code>: stores what emails you’ve actually sent, so you don’t accidentally send one again, unless you really want to for some reason.</li>
</ul>
<p>The default location for these is in a folder called <code>_blog2newsletter</code>. Every function that uses the cache, also has a <code>cache</code> argument.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">blog2newsletter</span><span class="op">)</span></span>
<span><span class="fu">b2n_create_cache</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If you don’t do this, you will get a message when you go to get subscriber data or draft the email.</p>
</div>
<div class="section level3">
<h3 id="get-subscriber-sheet-id">Get Subscriber Sheet ID<a class="anchor" aria-label="anchor" href="#get-subscriber-sheet-id"></a>
</h3>
<p>Now we grab the subscriber sheet ID from Google, and we will copy it into our newsletter script.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sheet_id</span> <span class="op">=</span> <span class="fu">googlesheets4</span><span class="fu">::</span><span class="fu">as_sheet_id</span><span class="op">(</span><span class="st">"urltosheet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">sheet_id</span><span class="op">)</span></span>
<span><span class="co"># copy this into your script to use for access, or use the URL if you want</span></span></code></pre></div>
<p>You can see the responses as a Google Sheet by clicking the little <strong>sheet</strong> icon on your form responses.</p>
<p><img src="reference/figures/where_to_get_sheet.png" width="100%"></p>
<p>And generate an initial cache of your subscriber info.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subscribers_id</span> <span class="op">=</span> <span class="st">"your-sheet-id-from-above"</span></span>
<span><span class="va">subscriber_data</span> <span class="op">=</span> <span class="fu"><a href="reference/b2n_fetch_subscribers.html">b2n_fetch_subscribers</a></span><span class="op">(</span><span class="va">subscribers_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="blog-rss">Blog RSS<a class="anchor" aria-label="anchor" href="#blog-rss"></a>
</h3>
<p>If you don’t already have an RSS feed for your blog, you <strong>need</strong> to set one up if you want to use <code>{blog2newsletter}</code> (see <a href="https://quarto.org/docs/websites/website-blog.html#:~:text=RSS%20Feed,-Blogs%20typically%20include%20an%20RSS" class="external-link">here</a> for <a href="https://github.com/quarto-dev/quarto-r" class="external-link">quarto</a> blogs, as well as <a href="https://rstudio.github.io/distill/blog.html#rss-feed" class="external-link">distill</a> and <a href="https://coolbutuseless.bitbucket.io/2018/02/07/blogdown-rss-feed-of-full-articles/" class="external-link">blogdown</a>). Thus far, I’ve only heavily tested <code>{blog2newsletter}</code> using a local RSS feed from a <a href="https://github.com/quarto-dev/quarto-r" class="external-link">quarto</a> based blog. These RSS feeds basically put the <strong>entirety</strong> of each post in each entry of the RSS. <strong>You should confirm this is the case for your own blog! If it is not, you should change your blog configuration so that the full contents are available at the RSS, and not just a preview or snippet.</strong> We query the RSS feed, grab the blog post asked for (typically the latest), and then push it into an email to be sent from GMail However, it works for any RSS feed that <code>{tidyrss}</code> can parse, including any hosted on the web, in case you want to use this for a different blogging platform.</p>
<p>We need to tell our script where the RSS feed lives. For <a href="https://github.com/quarto-dev/quarto-r" class="external-link">quarto</a> blogs with default outputs, we just need the blog directory. Alternatively, provide the full path to the <code>index.xml</code> file, or the URL of the hosted version are.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># default</span></span>
<span><span class="va">blog_dir</span> <span class="op">=</span> <span class="st">"~/path_to/blog_source"</span></span>
<span><span class="co"># another local blog source</span></span>
<span><span class="va">blog_dir</span> <span class="op">=</span> <span class="st">"~/path_to/blog_source/rendered/index.xml"</span></span>
<span><span class="co"># web based</span></span>
<span><span class="va">blog_dir</span> <span class="op">=</span> <span class="st">"https://myblog.com/rss.xml"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="test-composing-and-sending">Test Composing and Sending<a class="anchor" aria-label="anchor" href="#test-composing-and-sending"></a>
</h3>
<p>Finally, we can fetch the blog post and draft the email newsletter we want to send. Note that <code>extra_subject</code> here is whatever subject you want to add to your email, normally as a way to tell those getting the email that it is a newlsetter email. It will be <strong>prepended</strong> to the title of the post being sent out.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draft_email</span> <span class="op">=</span> <span class="fu"><a href="reference/b2n_compose.html">b2n_compose</a></span><span class="op">(</span><span class="va">blog_dir</span>,</span>
<span>                          subscriber_data <span class="op">=</span> <span class="va">subscriber_data</span>,</span>
<span>                          from_email <span class="op">=</span> <span class="st">"your_email@gmail.com"</span>,</span>
<span>                          extra_subject <span class="op">=</span> <span class="st">"subject"</span><span class="op">)</span></span></code></pre></div>
<p>If you want to preview it (and you authorized <code>gmailr</code> with the correct scopes), then you can use <code>b2n_create_draft</code> to push it to your GMail account and preview the email that is in <code>draft_email</code>. This is a thin wrapper around <code><a href="https://gmailr.r-lib.org/reference/gm_create_draft.html" class="external-link">gmailr::gm_create_draft</a></code>, as <code>blog2newsletter</code> stores the draft email as a list, with the email, and the post data so it can be checked against previously sent newsletter emails.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">b2n_create_draft</span><span class="op">(</span><span class="va">draft_email</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sending-posts-as-emails--newsletters">Sending Posts as Emails / Newsletters<a class="anchor" aria-label="anchor" href="#sending-posts-as-emails--newsletters"></a>
</h2>
<p>The easiest way to semi-automate sending your posts is to put all the necessary code in a <code>.R</code> file with the name <code>_blog2newsletter.R</code>.</p>
<p>This file includes the oauth code we used above, and goes through most of the steps from above.</p>
<p>Here is an example to start from.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gmailr.r-lib.org" class="external-link">gmailr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org" class="external-link">googlesheets4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">blog2newsletter</span><span class="op">)</span></span>
<span><span class="va">secrets_path</span> <span class="op">=</span> <span class="st">"secrets/client_secret_file_googleusercontent.com.json"</span></span>
<span><span class="va">oauth_cache</span> <span class="op">=</span> <span class="st">"secrets/gargle_cache/"</span></span>
<span></span>
<span><span class="co"># don't forget to use your actual email</span></span>
<span><span class="va">my_gmail</span> <span class="op">=</span> <span class="st">"my-gmail@gmail.com"</span></span>
<span></span>
<span><span class="co"># switch from directory, full path to index.xml, or url as needed</span></span>
<span><span class="va">blog_dir</span> <span class="op">=</span> <span class="st">"blog-directory"</span></span>
<span></span>
<span><span class="co"># newsletter subject</span></span>
<span><span class="va">extra_subject</span> <span class="op">=</span> <span class="st">"my newsletter"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  gargle_oauth_cache <span class="op">=</span> <span class="va">oauth_cache</span>,</span>
<span>  gargle_oauth_email <span class="op">=</span> <span class="va">secrets_path</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://gmailr.r-lib.org/reference/gm_auth_configure.html" class="external-link">gm_auth_configure</a></span><span class="op">(</span>path  <span class="op">=</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://gmailr.r-lib.org/reference/gm_auth.html" class="external-link">gm_auth</a></span><span class="op">(</span>scopes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compose"</span>, <span class="st">"send"</span><span class="op">)</span>, </span>
<span>        email <span class="op">=</span> <span class="va">my_gmail</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth_configure.html" class="external-link">gs4_auth_configure</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">secrets_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth.html" class="external-link">gs4_auth</a></span><span class="op">(</span></span>
<span>  scopes <span class="op">=</span> <span class="st">"https://www.googleapis.com/auth/spreadsheets.readonly"</span>,</span>
<span>  email <span class="op">=</span> <span class="va">my_gmail</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subscribers_id</span> <span class="op">=</span> <span class="st">"your-sheet-id"</span></span>
<span></span>
<span><span class="va">subscriber_data</span> <span class="op">=</span> <span class="fu"><a href="reference/b2n_fetch_subscribers.html">b2n_fetch_subscribers</a></span><span class="op">(</span><span class="va">subscribers_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">draft_email</span> <span class="op">=</span> <span class="fu"><a href="reference/b2n_compose.html">b2n_compose</a></span><span class="op">(</span><span class="va">blog_dir</span>,</span>
<span>                          subscriber_data <span class="op">=</span> <span class="va">subscriber_data</span>,</span>
<span>                          from_email <span class="op">=</span> <span class="va">my_gmail</span>,</span>
<span>                          extra_subject <span class="op">=</span> <span class="va">extra_subject</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/b2n_send_newsletter.html">b2n_send_newsletter</a></span><span class="op">(</span><span class="va">draft_email</span><span class="op">)</span></span></code></pre></div>
<p>Then, when you have new post that you want to send, in the subscription project, you only have to do:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">blog2newsletter</span><span class="fu">::</span><span class="fu"><a href="reference/b2n_run.html">b2n_run</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This <code>source</code>’s the file <code>_blog2newsletter.R</code> by default, and your newsletter is sent or drafted!</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing blog2newsletter</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Robert M Flight <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-8141-7788" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="table-of-contents">
<h2 data-toc-skip>Table of contents</h2>
<ul class="list-unstyled">
<li><nav id="toc"></nav></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert M Flight.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
